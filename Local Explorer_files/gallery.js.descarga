var max_subdomains=3;var unfav_icon="img/map/gallery-favorite-add.svg";var fav_icon="img/map/gallery-favorite-added.svg";var scroll=false;var filtering=0;function getWorkpadsForDashboard(c,a,b){c=c?c:0;$("#gallery_loading").fadeIn();$.getJSON("/ajax/get_workpads_for_gallery.php",{start:c,search:a,dashboard:1},function(f){var e="";var g=/simplebooklet|livebooklet/i;$("#gallery_loading").fadeOut();if(f&&f.length){$(f).each(function(q,w){var v=w.workpad_id;if($("#workpad_"+v).length){return}var i=parseInt(w.width);var u=parseInt(w.height);if(i>MAX_WIDTH){u=parseInt((u/i)*MAX_WIDTH);i=MAX_WIDTH}var s=document.domain.split(".").slice(-2).join(".");var t=location.protocol+"//"+s;var m=location.protocol+"//g"+q%max_subdomains+"."+s;if(DEV||QA||DEATHSTAR||!g.test(document.domain)){t=location.protocol+"//"+document.domain;m=location.protocol+"//"+document.domain}var p=m+"/thumbs/"+w.workpad_key+".jpg";var j=m+"/thumbs/w192/"+w.workpad_key+".jpg";var l="/design.php?wpKey="+w.workpad_key;var k="/share.php?wpKey="+w.workpad_key;var n="/analytics.php?wpKey="+w.workpad_key;var o=l+"#pid=modalcopybooklet";var r=w.trial_days;var h=w.expiration_days;w.read_only=parseInt(w.read_only);e+="<div id='workpad_"+v+"' class='workpad gallery finderentry "+(w.expired==1?"expired":"")+"'><a href='"+(w.read_only?k:l)+"'><img class='booklet_thumb' src='"+j+"' style='width:"+i+"px; height:"+u+"px' /></a><div class='workpad_meta'><div class='workpad_name'>"+w.name+"<br><hr style='margin: 4px 0px' />"+(w.read_only?"":"<a class='action delete hide-for-small' data-workpad_id='"+v+"'><img src='img/interface/deletebooklet.png' title='Delete this web booklet permanently.' /></a>"+(w.expired==1?"":"<a class='action hide-for-small' href='"+o+"'><img src='img/interface/copybooklet.png' title='Make a duplicate of this web booklet.' /></a>"))+(w.expired==1?"":"<a class='action tiny round button orange mymashups_publish' href='"+n+"'>Stats</a><a class='action tiny round button green mymashups_publish' style='margin-right: 3px;' href='"+k+"'>Share</a>"+(w.read_only?"":"<a class='action tiny round button purple hide-for-small' style='margin-right: 3px;' href='"+l+"'>Edit</a>"))+"</div>"+(w.plus=="0"?"<hr style='margin: 4px 0px' /><div style='font-size: 12px; text-align: left; padding-top: 10px;'>"+(w.expired==1?"Booklet Expired<br>removal in "+w.removal_days+" days":"Expires "+(r<=0?"today!":"in "+r+" days"))+((r<=BOOKLET_TRIAL_DAYS)?"<span class='button radius small "+(r<=0?"alert":"")+"' style=' float: right; margin-top: -7px;' onclick='W[\"id\"]="+v+'; DisplayDIV("modalupgradehero",false,false,false,true);\'>'+(h>0?"Renew":"Upgrade")+"</span>":"")+"</div>":"")+"</div></div>"});var d=$(e);$("#workpads").append(d).isotope("appended",d)}if(typeof b==="function"){b(f)}})}function getWorkpadsForGallery(e,a,c,b,d){e=e?e:0;c=c?c:0;$("#gallery_loading").fadeIn();$.cookie=(typeof $.cookie==="function")?$.cookie:function(){};$.getJSON("/ajax/get_workpads_for_gallery.php",{start:e,admin:a,account_id:c,search:b},function(i){var h="";$("#gallery_loading").fadeOut();var l=/simplebooklet|livebooklet/i;var k=(typeof getFavouritesFromCookie==="function");var m=k?getFavouritesFromCookie():[];var f=(typeof $.cookie("selectCategory")==="undefined")?"all":$.cookie("selectCategory");var j=(typeof $.cookie("selectNeighbourhood")==="undefined")?"all":$.cookie("selectNeighbourhood");if(f){$("#selectCategory").val(f);$("#categoriesButton").text($("#selectCategory option:selected").text())}if(j){$("#selectNeighbourhood").val(j);$("#placesButton").text($("#selectNeighbourhood option:selected").text())}if(i&&i.length){$(i).each(function(q,w){if(w.tourism!=1){k=false}var B=parseInt(w.width);var x=parseInt(w.height);if(B>MAX_WIDTH){x=parseInt((x/B)*MAX_WIDTH);B=MAX_WIDTH}var n=parseInt(w.gallery||c);var v=(n?"checked":"");var z="gallery_"+w.workpad_id;var C=location.protocol+"//"+(DEV||QA?document.domain:document.domain.split(".").slice(-2).join("."));var p=location.protocol+"//g"+q%max_subdomains+"."+document.domain.split(".").slice(-2).join(".");if(DEV||QA||DEATHSTAR||!l.test(document.domain)){C=location.protocol+"//"+document.domain;p=location.protocol+"//"+document.domain}if(!$("#workpad_"+w.workpad_id).length){var r=C+"/publish.php?wpKey="+w.workpad_key;var u=escape(r);var E=C+"/m/"+w.workpad_key;var J=p+"/thumbs/"+w.workpad_key+".jpg";var H=p+"/thumbs/w192/"+w.workpad_key+".jpg";var o='<a href="https://www.facebook.com/sharer/sharer.php?u='+u+'" target="_blank">';var s='<a href="https://twitter.com/share?url='+u+'" target="_blank">';var F='<a href="http://pinterest.com/pin/create/button/?url='+u+"&media="+escape(J)+"&description="+escape(w.comment)+'" target="_blank">';var t='<a href="https://plus.google.com/share?url='+u+' target="_blank">';var A=w.category_id_list;var I=p+"/"+unfav_icon;if(m.length){if(m.indexOf(w.workpad_key)!=-1){I=p+"/"+fav_icon;if(A.length){A+=","}A+=FAVOURITES}}var G=w.neighbourhood_id;var y=w.customer_phone;var D=unescape(w.comment);if(D!=""){D="<br><hr style='margin: 4px 0px;'><span style='font-size: 12px;'>"+D+"</span>"}h+="<div id='workpad_"+w.workpad_id+"' class='workpad "+(n?"gallery":"")+" "+a+"' data-categories='"+A+"' data-neighbourhood_id='"+G+"' ><a href='"+r+"' target='_blank'><img class='booklet_thumb' src='"+H+"' style='width:"+B+"px; height:"+x+"px' /></a><div class='workpad_meta'><div class='workpad_name'>"+(k?"<a href='"+r+"' target='_blank'><div value='View' class='open button radius ' style='width: 45px; float: left;padding: 4px 8px; margin-top: 3px; margin-bottom: 6px; margin-left: 0px; margin-right: 5px; border: 0px solid #fff;'>view</div></a><a href='"+E+"' target='_self'><div value='Map' class='open button radius ' style='width: 45px; float: left;padding: 4px 8px; margin-top: 3px; margin-bottom: 6px; margin-left: 0px; margin-right: 5px; border: 0px solid #fff;'>map</div></a><a href='tel://"+y+"' title='phone this business: "+y+"' style='float: right; font-size: 14px; padding-top: 6px;'>"+y+"</a>":"")+"<br><hr style='margin: 4px 0px'>"+w.name+D+"<br><hr style='margin: 4px 0px'>"+t+"<i class='social foundicon-google-plus' style='float:right; padding: 3px; font-size: 24px; color: #dd4b39;'></i></a>"+F+"<i class='social foundicon-pinterest' style='float:right; padding: 3px; font-size: 24px; color: #cc2127;'></i></a>"+s+"<i class='social foundicon-twitter' style='float:right; padding: 3px; font-size: 24px; color: #55acee;'></i></a>"+o+"<i class='social foundicon-facebook' style='float:right; padding: 3px; font-size: 24px; color: #3b5998;'></i></a><br><hr style='margin: 4px 0px'><span style='float: left;'>"+(k?"<span class='add_to_favourites' data-workpad-key="+w.workpad_key+" data-workpad-id="+w.workpad_id+"><img id='favs_"+w.workpad_id+"' src='"+I+"' data-image-url-base="+p+"/></span>":"")+"</span><span style='float: right;'><span class='heart-icon'>j</span>"+w.views+"</span></div>"+(a?"<div class='workpad_admin'>created: "+w.create_date+"  views: "+w.views+"<br /><input class='gallery_checkbox' type='checkbox' id='"+z+"' "+v+" data-workpad_id='"+w.workpad_id+"' /><label for='"+z+"'> show on gallery</label></div>":"")+"</div></div>"}});var g=$(h);$("#workpads").append(g).isotope("appended",g)}if(typeof d==="function"){d(i)}})}function getWorkpadsOnScroll(a,c,b){$(window).scroll(function(){if($(window).scrollTop()+$(window).height()==$(document).height()){var d=$("#workpads").find(".workpad").length;if(!$("#workpads").hasClass("loading")){$("#workpads").addClass("loading");getWorkpadsForGallery(d,a,c,b,function(e){if($("#selectNeighbourhood").val()||$("#selectCategory").val()){filterByNeighbourhoodAndCategory($("#selectNeighbourhood").val(),$("#selectCategory").val())}$("#workpads").removeClass("loading");if(e.length==0){$("#workpads").append("<div class='end_of_workpads'>End of Booklets</div>").addClass("loading")}})}}})}function galleryFilter(){console.log("filtering");var b=$(this).val().toLowerCase();var a=$("#workpads").find(".workpad.hidden").length;$("#workpads").find(".workpad").each(function(){var c=$(this);if(b!=""){if(c.html().toLowerCase().indexOf(b)>=0){c.removeClass("hidden").fadeIn()}else{c.addClass("hidden").fadeOut()}}else{c.removeClass("hidden").fadeIn()}});if(a!=$("#workpads").find(".workpad.hidden").length){$("#workpads").isotope({filter:":not(.hidden)"})}}function galleryEmail(){var b=loadPopup("galleryemail",true);var a=b.find("form");b.find(".gallery_title").text($("title").text());DisplayDIV(b)}$(document).on("click","#modal-email-send",function(a){a.preventDefault();galleryEmailSend(this);return false});function galleryEmailSend(c){var f=$(c);var b=f.closest("form");var d=b.find("input[name=fromname]");if(!b.length){alert("Could not find email form.")}if(!validateEmail.test(d.val())){d.addClass("invalid").focus();return false}var e={};var a=window.location;e.subject=b.find('input[name="subject"]').val();if(b.find('input[name="url"]').val()!=""){a=b.find('input[name="url"]').val()}e.emailHtml=b.find("textarea").val()+"<br><br><a href='"+a+"'>"+a+"</a>";f.hide();b.find(".sending").show();e.referer="rdp.js";b.ajaxSubmit({url:"/email.php",type:"POST",data:e,success:function(){b.find(".sending").hide();b.find(".sent").show()},error:ajaxError,beforeSend:ajaxBefore,complete:ajaxComplete});return false}function galleryEmbed(){var b=loadPopup("galleryembed");var a=b.find("form");b.find(".gallery_title").text($("title").text());a.find("textarea").val("<iframe src='"+window.location+"' width='700' height='500' style='border: 0px;'></iframe>");DisplayDIV(b)}function galleryQrCode(){window.open("http://chart.apis.google.com/chart?cht=qr&chs=300x300&chl="+escape(window.location)+"&chld=H|0","_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=yes, width=300, height=300")}function filterByCategory(a){if(a){$(".workpad").each(function(){var b=(new String($(this).data("categories"))).split(",");if(b&&(b.indexOf(a)>=0||a=="all")){$(this).removeClass("hidden").show()}else{$(this).addClass("hidden").hide()}})}else{$(".workpad").removeClass("hidden").show()}$("#workpads").isotope({filter:":not(.hidden)"});$("#workpads").isotope("reLayout")}function filterByNeighbourhood(a){if(a){$(".workpad").each(function(){var b=$(this).data("neighbourhood_id");if(a&&(a==b||a=="all")){$(this).removeClass("hidden").show()}else{$(this).addClass("hidden").hide()}})}else{$(".workpad").removeClass("hidden").show()}$("#workpads").isotope({filter:":not(.hidden)"});$("#workpads").isotope("reLayout")}function filterByNeighbourhoodAndCategory(a,b){$(".workpad").each(function(){var c=(new String($(this).data("categories"))).split(",");if((a=="all"||a==$(this).data("neighbourhood_id"))&&(b=="all"||c.indexOf(b)!=-1)){$(this).removeClass("hidden").show()}else{$(this).addClass("hidden").hide()}});$("#workpads").isotope({filter:":not(.hidden)"});$("#workpads").isotope("reLayout")};