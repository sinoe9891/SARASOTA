function toRad(a){return a*Math.PI/180}function distance(g,i,f,h){if(typeof g==="undefined"||typeof i==="undefined"||typeof f==="undefined"||typeof h==="undefined"){return false}var j=6371;var n=toRad(g);var l=toRad(f);var b=toRad(f-g);var e=toRad(h-i);var o=Math.sin(b/2)*Math.sin(b/2)+Math.cos(n)*Math.cos(l)*Math.sin(e/2)*Math.sin(e/2);var m=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));var k=j*m;return k}function setSelectCookies(){$.cookie($("#selectCategory").attr("id"),$("#selectCategory").val(),{path:"/"});$.cookie($("#selectNeighbourhood").attr("id"),$("#selectNeighbourhood").val(),{path:"/"});if(typeof geoMarker!=="undefined"){if(geoMarker!=null){if(geoMarker.position!=null){$.cookie("geolocation",geoMarker.position.toString(),{expires:0.003472,path:"/"})}}}return true}function getSelect(a){return $.cookie(a)}$(document).on("click",".add_to_favourites",function(){var a=$(this).data("workpad-key");var b=$(this).data("workpad-id");setGalleryFavourite(a,b)});function clearGalleryFavourites(){var b=$('[id^="favs_"]').first().data("image-url-base");var a=b+unfav_icon;$('[id^="favs_"]').attr("src",a)}function galleryFavourite(e,b){var c="#workpad_"+e;var a="#favs_"+e;var d=$(a).data("image-url-base");if(b){$(a).attr("src",d+fav_icon)}else{$(a).attr("src",d+unfav_icon)}}function setGalleryFavourite(b,d){var c=getFavouritesFromCookie();if(!c.length){c=[b];galleryFavourite(d,true)}else{var a=c.indexOf(b);if(a==-1){c.push(b);galleryFavourite(d,true)}else{c.splice(a,1);galleryFavourite(d,false)}}updateCookie(c);setFavouritesNav(true)}$(document).on("click","#checkfavourites",function(){DisplayDIV("favourites",null,null,null,true)});$(document).on("click",".show-favourites",function(){if($("#selectCategory option[value='"+FAVOURITES+"']").length){$("#selectCategory").val(FAVOURITES).change();$("#categoriesButton").text($("#selectCategory option:selected").text())}else{displayMessage("Your favorites list is empty. Click an experience and click the star to add it to your favorites.")}});$(document).on("click",".clear-favourites",function(){clearFavourites()});$(document).on("click",".action-favourites-clear",function(){var a={message:"Are you sure you want to clear your favorites? No take backs.",action_confirm:" action-favourites-confirmclear ",action_cancel:" modal-close "};materialModal("modal-confirm",true,a)});$(document).on("click",".action-favourites-confirmclear",function(){clearFavourites()});$(document).on("click",".action-favourites-showmodal",function(){var b=getFavouritesFromCookie();var a=b.length?{array_favorites:b,lat:myLat,lng:myLng,account_id:account_id}:"{}";if(b.length){materialModal("modal-favourites",true,a)}else{materialModal("modal-favourites-empty",false,{})}});$(document).on("click",".action-favourites-toggle",function(){var b=$(this).data("workpad_key");var a=$(this).find("i");updateFavourites(b,a)});$(document).on("click",".action-favourites-close",function(){$(".action-favourites-closebar").fadeOut();$("#selectCategory").val("all");$("#selectCategory").trigger("change")});$(document).on("click",".action-favourites-map",function(){cancelDirections();$(".action-favourites-closebar").fadeIn();filterByCategory(true)});$(document).on("click",".send-favourites-email",function(){var c=$(this).data("webuser-id");if(!c){return displayMessage("You don't appear to have added any favorites yet.")}var b=$(this).closest("form");var d=b.find("input[name=email_from]").val();var a=b.find("input[name=email_to]").val();if(!validateEmail.test(d)){return displayMessage("Please enter a From email address.")}if(!validateEmail.test(a)){return displayMessage("Please enter a To email address.")}data={webuser_id:c,vanity:vanity,email_from:d,email_to:a};$.ajax({url:"/ajax/emailer_favourites.php",type:"POST",dataType:"json",data:data,success:function(e){HideDIV();displayMessage(e.message)}})});function updateCookie(a){if(a.length){$.cookie("favourites",a.join("|"),{expires:365,path:"/"})}else{$.removeCookie("favourites",{path:"/"})}}function clearFavourites(){if(typeof workpadMarkers==="object"){for(var a in workpadMarkers){if(workpadMarkers[a].isFavourite){setMarkerFavourite(workpadMarkers[a],false,false)}}}else{clearGalleryFavourites()}updateCookie([]);setFavouritesNav(false)}function setMarkerFavourite(c,a,b){c.isFavourite=b;c.zIndex=2;if(a){a.removeClass();if(b){a.addClass(imgFav)}else{a.addClass(imgUnFav)}}var d=getFavouritesFromCookie();if(!d.length&&b){d=[c.id]}else{if(d.indexOf(c.id)==-1&&b){d.push(c.id)}else{if(d.indexOf(c.id)!=-1&&!b){d.splice(d.indexOf(c.id),1)}}}updateCookie(d)}function updateFavourites(b,a){var d=getMarkerByWorkpadKey(b);if(!d.isFavourite){setMarkerFavourite(d,a,true)}else{setMarkerFavourite(d,a,false);var c=getFavouritesFromCookie();if(!c.length){$("#selectCategory").val("all").change();$("#categoriesButton").text($("#selectCategory option:selected").text());$(".action-favourites-closebar").fadeOut();setFavouritesNav(false)}}}function isFavourite(c){var b=getFavouritesFromCookie();var a=b.indexOf(c);if(a>-1){return 1}else{return 0}}function cleanFavourites(){var c=getFavouritesFromCookie();var d=[];for(var b in c){for(var a in booklets_for_map){if(booklets_for_map[a]["workpad_key"]==c[b]){d.push(c[b]);break}}}updateCookie(d)}function getFavouritesFromCookie(){var a=$.cookie("favourites");var b=[];if(a!=null){if(a.length){b=a.split("|")}}return b}function setBottomFavouritesNav(){if($.cookie("favourites")){$("#img_favourites").attr("src","/img/material/star.svg")}else{$("#img_favourites").attr("src","/img/material/star-outline.svg")}}function setFavouritesNav(a){if(!a){$("#selectCategory").val("all");$("#selectCategory").trigger("change");$(".action-favourites-closebar").fadeOut()}return true}$(document).on("click",".select-list .item",function(){var d=$(this);var b=d.closest(".select-list");var c=d.data("value");var a=d.text();$(b.data("select")).val(c).trigger("change");$(b.data("label")).text(a);HideDIV()});